<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù†Ø¸Ø§Ù… ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body style="font-family: sans-serif; direction: rtl; padding: 20px;">

  <h2>ğŸ“¤ Ø¥ØµØ¯Ø§Ø± Ø´Ù‡Ø§Ø¯Ø©</h2>
  <input type="text" id="certID" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©"><br><br>
  <input type="text" id="cid" placeholder="CID Ù…Ù† Pinata"><br><br>
  <input type="text" id="studentName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨"><br><br>
  <button onclick="issueCertificate()">Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</button>

  <hr>

  <h2>ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø´Ù‡Ø§Ø¯Ø©</h2>
  <input type="text" id="verifyID" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©"><br><br>
  <button onclick="verifyCertificate()">ØªØ­Ù‚Ù‚</button>

  <script>
    const contractAddress = "0xd9145CCE52D386f254917e481eB44e9943F39138";
    const abi = [
      {
        "inputs": [
          { "internalType": "string", "name": "_certificateID", "type": "string" },
          { "internalType": "string", "name": "_cid", "type": "string" },
          { "internalType": "string", "name": "_studentName", "type": "string" }
        ],
        "name": "issueCertificate",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "string", "name": "_certificateID", "type": "string" }
        ],
        "name": "getCertificate",
        "outputs": [
          { "internalType": "string", "name": "cid", "type": "string" },
          { "internalType": "string", "name": "studentName", "type": "string" }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "string", "name": "_certificateID", "type": "string" }
        ],
        "name": "verifyCertificate",
        "outputs": [
          { "internalType": "bool", "name": "", "type": "bool" }
        ],
        "stateMutability": "view",
        "type": "function"
      }
    ];

    let provider, signer, contract;

    async function connect() {
      if (typeof window.ethereum === 'undefined') {
        alert("ÙŠØ±Ø¬Ù‰ ØªØ«Ø¨ÙŠØª MetaMask");
        return;
      }

      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      contract = new ethers.Contract(contractAddress, abi, signer);
    }

    async function issueCertificate() {
      await connect();

      const id = document.getElementById("certID").value;
      const cid = document.getElementById("cid").value;
      const name = document.getElementById("studentName").value;

      if (!id || !cid || !name) {
        alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
        return;
      }

      try {
        const tx = await contract.issueCertificate(id, cid, name);
        await tx.wait();
        alert("âœ… ØªÙ… Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­");
      } catch (err) {
        console.error(err);
        alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©");
      }
    }

    async function verifyCertificate() {
      await connect();

      const verifyID = document.getElementById("verifyID").value;
      if (!verifyID) {
        alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©");
        return;
      }

      try {
        const isValid = await contract.verifyCertificate(verifyID);
        if (isValid) {
          const data = await contract.getCertificate(verifyID);
          alert(`âœ… Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ØµØ­ÙŠØ­Ø©\nØ§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨: ${data.studentName}\nCID: ${data.cid}`);
        } else {
          alert("âŒ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© Ø£Ùˆ ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
        }
      } catch (err) {
        console.error(err);
        alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚");
      }
    }
  </script>

</body>
</html>
